<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no"
    />
    <meta name="description" content="Prototype Site" />
    <!-- <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="96x96" href="assets/images/favicon.png"> -->
    <meta name="author" content="Ernest Pena Jr" />
    <meta name="HandheldFriendly" content="true" />
    <title>AIM</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/fontawesome-pro-5.15.4/css/all.css" />
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="node_modules/datatables.net-bs5/css/dataTables.bootstrap5.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
  </head>
<style>
.btn-custom {
    background-color: #f97316; /* Example orange color */
    color: white; /* Text color */
}

.btn-custom:hover {
    background-color: #dd6b20; /* Darker shade of orange for hover effect */
    color: white;
}
.varela-round-regular {
  font-family: "Varela Round", sans-serif;
  font-weight: 400;
  font-style: normal;
}
.bg-custom {
    background-color: #466a9a;
}
.Top{
  background-color: #ff6384;
}
.High{
  background-color: #ff9f40;
}
.Moderate{
  background-color: #ffcd56;
}
.Low{
  background-color: #36a2eb;
}
</style>
  <body>
    <div class="main-container d-flex">
      <div class="sidebar border-2 border-end border-secondary bg-custom" id="side_nav">
        <div class="header-box px-2 pt-3 pb-4 d-flex justify-content-between">
          <h1 class="fs-4 d-flex justify-content-center align-conent-center w-100">
            <span class="rounded px-2 me-2 text-white fs-1" style="font-family: Varela Round, sans-serif">AIM</span>
          </h1>
          <button class="btn d-md-none d-block close-btn px-1 py-0 text-white">
            <i class="fal fa-stream"></i>
          </button>
        </div>

        <ul class="list-unstyled px-2">
          <li class="active">
            <a href="#" class="text-decoration-none px-3 py-2 d-block  fs-4" ><i class="fal fa-home"></i> Dashboard</a >
          </li>
          <li class="">
            <a href="#" class="text-decoration-none px-3 py-2 d-block  fs-4" ><i class="fal fa-sliders-h"></i> Settings</a >
          </li>


          <li class="">
            <a href="#" class="text-decoration-none px-3 py-2 d-block  fs-4" ><i class="fal fa-users"></i> Accounts</a >
          </li>
          <li class="">
            <a href="#" class="text-decoration-none px-3 py-2 d-block  fs-4" ><i class="fal fa-user-headset"></i> Help</a >
          </li>
        </ul>
      </div>
      <div class="content">
        <nav class="navbar navbar-expand-md navbar-light border-2 border-bottom border-secondary shadow-md bg-secondary-subtle">
          <div class="container-fluid">
            <div class="d-flex justify-content-between d-md-none d-block">
              <button class="btn px-1 py-0 open-btn me-2"> <i class="fal fa-stream"></i> </button>
              <a class="navbar-brand fs-4" href="#" ><span class="bg-dark rounded px-2 py-0 text-white"></span></a >
            </div>
            <form class="" role="search">
                <div class="position-relative icon-inside-input">
                    <input id="externalSearchBox" class="form-control" type="search" placeholder="Search by product name" aria-label="Search" style="width:600px">
                    <i class="far fa-search position-absolute"></i>
                </div>
  
            </form>
            <button
              class="navbar-toggler p-0 border-0"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation" >
              <i class="fal fa-bars"></i> </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent" >
                
              <ul class="navbar-nav mb-2 mb-lg-0">
                <ul class="navbar-nav mb-2 mb-lg-0">
                 
                <li class="nav-item">
                  <a class="nav-link " href="#"><i class="fas fa-bell-on fa-2x"></i></a >
                </li>
                <li class="nav-item">
                  <a class="nav-link" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"><i class="fas fa-filter fa-2x"></i></a>
                </li>
                <div class="d-flex align-items-center justify-content-center px-1">
                  <div class="dropdown">
                      <button class="btn btn-sm dropdown-toggle bg-layout  justify-content-center" type="button" id="ProfileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user-circle fa-2x"></i> <span id="profileName" class="fs-5 align-content-center justify-content-center text-dark fw-bold" data-bs-theme="auto"></span> 
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown" id="profileDropdown" >
                          <li><a class="dropdown-item" data-bs-value="profile" href="#"><i class="fas fa-user"></i> Profile</a></li>
                          <li><a class="dropdown-item" data-bs-value="settings" href="#"><i class="fas fa-user-cog"></i> Settings</a></li>
                          <li><a class="dropdown-item" data-bs-value="signout" href="#"><i class="fas fa-portal-exit"></i> Sign Out</a></li>
                      </ul>
                  </div>
              </div>
              </ul>
            </div>
          </div>
        </nav>
        
        <div class="dashboard-content px-3 pt-4 bg-secondary-subtle">
          <div class="row">
            <div class="col-md-4">
                <div class="card mb-3">
                    <div class="card-body">
                      <h4 class="card-title text-uppercase">Key Performance Indicator</h4>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <div class="card h-100 shadow-sm bg-primary text-white">
                                  <div class="card-body justify-content-center align-items-center">
                                      <div class="d-flex justify-content-center align-items-center">
                                          <span class="text-uppercase fw-lighter"><i class="far fa-usd-circle"></i> volume</span>
                                      </div>
                                      <div class="d-flex justify-content-center align-items-center">
                                          <span id="volume" class="fs-2 ms-2">0</span>
                                      </div>
                                  </div>
                                </div>
                            </div>
                            </div>
                    <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card h-100 shadow-sm bg-secondary text-white">
                                    <div class="card-body justify-content-center align-items-center">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span class="text-uppercase fw-lighter"><i class="fas fa-store-alt"></i> vendors</span>
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span id="vendors" class="fs-2 ms-2">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                              
                            <div class="col-md-6 mb-3">
                                <div class="card h-100 shadow-sm bg-dark text-white">
                                    <div class="card-body justify-content-center align-items-center">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span class="text-uppercase fw-lighter"><i class="far fa-inventory"></i> products</span>
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span id="products" class="fs-2 ms-2">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100">
                  <div class="card-body">
                      <canvas class="chart" width="400" height="200"></canvas> 
                      <!-- <canvas id="geoChart" width="400" height="200"></canvas>-->
                   </div>
              </div>
          </div>

            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <canvas id="myDonutChart"></canvas>
                    </div>
                </div>
            </div>
        </div>    
        <div class="row mt-3">
          <div class="col-md-1"></div>
          <div class="col-md-2"><button id=" " class="btn btn-dark btnX w-100">Reload "All" Data</button></div>
          <div class="col-md-2"><button id="Top" class="btn btn-danger btnX w-100">Filter "<span class="fw-bold">Top</span>" Data</button></div>
          <div class="col-md-2"><button id="High" class="btn btn-custom btnX w-100">Filter "<span class="fw-bold">High</span>" Data</button></div>
          <div class="col-md-2"><button id="Moderate" class="btn btn-warning btnX w-100">Filter "<span class="fw-bold">Moderate</span>" Data</button></div>
          <div class="col-md-2"><button id="Low" class="btn btn-primary btnX w-100">Filter "<span class="fw-bold">Low</span>" Data</button></div>
          <div class="col-md-1"></div>
        </div>

        <div class="row mt-3">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  
                  
                    <table id="aimTblData" class="table table-sm table-striped data-table table-hover" style="width: 100%" >
                    <thead>
                      <tr>
                        <th>RATING</th>
                        <th>SCORE</th>
                        <th>VENDOR NAME</th>
                        <th>SELLER NAME</th>
                        <th>PRODUCT NAME</th>
                        <th>STREET</th>
                        <th>CITY</th>
                        <th>STATE</th>
                        <th>ZIP CODE</th>
                      </tr>
                    </thead>
                  </table>


                </div>
              </div>
            </div>
          </div>
        </div>


        </div>
      </div>
    </div>

    <div class="offcanvas offcanvas-end" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h4 class="offcanvas-title text-uppercase " id="offcanvasRightLabel">Attributes & Filters</h4>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
    
      <div class="card m-4">
        <div class="card-body">
          <div class="card-title h3">Click to apply Attributes</div>
          <div class="offcanvas-body">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
              <label class="form-check-label" for="flexSwitchCheckDefault">Article Findings</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" checked>
              <label class="form-check-label" for="flexSwitchCheckChecked">Seller Name Change</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDisabled">
              <label class="form-check-label" for="flexSwitchCheckDisabled">Price Difference</label>
            </div>
          </div>
        </div>
      </div>
    </div>



<!--(Page Loader Modal)-->
    <div  id="loader" class="modal" >
      <div class="modal-dialog modal-dialog-centered"style="width:150px">
        <div class="modal-content bg-info">
          <div class="modal-body text-center">
            <i class="fas fa-cog fa-spin fa-4x"></i>
            <p class="mt-3">Loading...</p>
            <span class="mt-0" style="font-size:10px;">powered by shieldlytics</span>
          </div>
        </div>
      </div>
    </div>
<!--(Page Loader Modal)-->
<!--(Vendor Details Modal)-->
    <div id="vendorReport" class="modal fade">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Detailed Report "<span id="VendorName"></span>"</h5>
            <button id="xMarksTheSpot" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="h4">PRODUCT: <span id="PRODUCT_NAME"></span></p>
            <p>Identified on vendor platform: <span id="VENDOR_NAME"></span> Marketplace</p>
            <p>Rating: <span class="SCORE_CATEGORY"></span></p><br>

            <p>The seller makes use of a name similar to a more well-known and established company, As <span id="SELLER_FIRST_NAME"></span></p>
            <p>Unable to identify business filings under company name in state they are operating out of.</p>
            <p>While the seller has 75 listings on <span id="VENDOR_NAME"></span> Marketplace there are only 13 unique items being sold with the same product being listed multiple times at different price points.</p>
            <p>Pricing ranges between <span id="PRICE_VARIANCE"></span> and <span id="PRODUCT_PRICE"></span> per unit which is both a markedly lower and higher price offered by other vendors.</p>
     <br>
     <div class="card imageCompare" style="display: none;">
        <div class="card-body">
            <div class="card-title h5">
                <p>Product Image Comparison</p>
                <div class="row">
                    <div class="col-sm-6">
                        <img src="assets/images/Product_Images/ove-glove.jpeg" class="img-fluid" alt="Orginal" ><br>
                        <p>Original from manufacturer</p>
                    </div>
                    <div class="col-sm-6">
                        <img src="" class="img-flui fake" height="354" alt="Fake"><br>
                        <p class="text-center fakeFrom">Counterfeit product</p>
                    </div>
                </div>
            </div>

        </div>
     </div>
          <br>
          <p>If you feel the <span id="SCORE_CATEGORY" class="fw-bold"></span> rating is incorrect, you may submit your rating along with a detailed statement as to why the rating should be changed.</p>
          <br>
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Rating Change</h5>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
                  <label class="form-check-label" for="inlineRadio1">TOP</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
                  <label class="form-check-label" for="inlineRadio2">HIGH</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3">
                  <label class="form-check-label" for="inlineRadio3">MODERATE</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio4" value="option4">
                  <label class="form-check-label" for="inlineRadio4">LOW</label>
                </div>
                <div class="form-floating">
                  <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                  <label for="floatingTextarea">Detailed Statement</label>
                </div>
    
              </div>
            </div>
    
          <div class="modal-footer">
            <button id="modalClose" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button id="raitingChange" type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
<!--(Vendor Details Modal)-->
    




  
    <script src="assets/js/app.js"></script>
    <script src="node_modules/chart.js/dist/chart.umd.js"></script>
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script src="node_modules/datatables.net/js/jquery.dataTables.js"></script>
    <script src="node_modules/datatables.net-bs5/js/dataTables.bootstrap5.js"></script>
  </body>



  
</html>

  


<script>
const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

  $(document).ready(function () {
$('#resetAll').on('click', function(){
    getByRisk(rl=' ');
    $('.btnX').css('background-color', '');
    $('#loader').hide();
    $('#externalSearchBox').val('');
    $('#externalSearchBox').keyup();
    $('#raitingChange').attr('id', '');
    $('#raitingChange').text('Rating Change');
    $('#raitingChange').removeClass('btn-danger btn-custom btn-warning btn-primary');
    $('#raitingChange').addClass('btn-primary');
});
$('#modalClose, #xMarksTheSpot').on('click', function(){
    $('#loader').hide();
});
    $('.btnX').click(function(){
      $('.btnX').css('background-color', '');
        var rl = $(this).attr('id');
        if(rl == "TOP"){
          $(this).css('background-color', 'rgb(255, 99, 132)').addClass('rounded').find('i').toggleClass('fa-light-switch-off fa-light-switch-on');
        }else if(rl == "HIGH"){
          $(this).css('background-color', 'rgb(255, 159, 64)').addClass('rounded').find('i').toggleClass('fa-light-switch-off fa-light-switch-on');
        }else if(rl == "MODERATE"){
          $(this).css('background-color', 'rgb(255, 205, 86)').addClass('rounded').find('i').toggleClass('fa-light-switch-off fa-light-switch-on');
        }else if(rl == "LOW"){
          $(this).css('background-color', 'rgb(54, 162, 235)').addClass('rounded').find('i').toggleClass('fa-light-switch-off fa-light-switch-on');
        }
        getByRisk(rl);
    });

    $('#raitingChange').click(function(){
        var rl = $(this).attr('id');
        getByRisk(rl);
    });


    $(".sidebar ul li").on("click", function () {
      
      $(".sidebar ul li.active").removeClass("active");
      $(this).addClass("active")
     
    });

    $(".open-btn").on("click", function () {
      $(".sidebar").addClass("active");

    });

    $(".close-btn").on("click", function () {
      $(".sidebar").removeClass("active");
    });

    $(".data-table").each(function (_, table) {
      $(table).DataTable();
    });
    var rl = " ";
    getByRisk(rl);
    loadStateSales()
});

  function lineChart() {
        var ctx = $('#myLineChart').get(0).getContext('2d');
        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['2016', '2017', '2018', '2019', '2020'], // Example years
                datasets: [{
                    label: 'Actual Revenue',
                    data: [100000, 120000, 130000, 125000, 140000], // Example revenue data
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }, {
                    label: 'Losses Due to Fraud',
                    data: [500, 7000, 45000, 20500, 75000], // Example fraud loss data
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Amount in USD'
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
            }
        });
    }

    function loadChart(top, high, moderate, low) {
    const charts = document.querySelectorAll(".chart");
    charts.forEach(function (chart, index) {
        // Attempt to retrieve an existing chart instance
        var existingChart = Chart.getChart(chart); // New way to get existing chart instance by passing the canvas
        if (existingChart) {
            existingChart.destroy();
        }

        var ctx = chart.getContext("2d");
        var myChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: ['TOP', 'HIGH', 'MODERATE', 'LOW'],
                datasets: [{
                    label: 'My First Dataset',
                    data: [top, high, moderate, low],
                    backgroundColor: [
                        'rgb(255, 99, 132)',
                        'rgb(255, 159, 64)',
                        'rgb(255, 205, 86)',
                        'rgb(54, 162, 235)',
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                    },
                },
            },
        });
    });
}

function donutChart(top, high, moderate, low) {
    var ctx = $('#myDonutChart').get(0).getContext('2d');
    // Check and destroy the existing chart if it's there
    var existingChart = Chart.getChart("myDonutChart"); // Use the ID or context of the canvas
    if (existingChart) {
        existingChart.destroy();
    }

    var myDonutChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['TOP', 'HIGH', 'MODERATE', 'LOW'],
        datasets: [{
            label: 'My First Dataset',
            data: [top, high, moderate, low], // Assume these are your data variables
            backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(54, 162, 235)',
            ],
            hoverOffset: 4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
            onClick: function(evt, element, chart) {
                if (element.length > 0) {
                    var firstPoint = element[0];
                    var label = this.data.labels[firstPoint.index];
                    var value = this.data.datasets[firstPoint.datasetIndex].data[firstPoint.index];

                    switch (label) {
                        case 'TOP':
                            getByRisk(rl='TOP')
                            break;
                        case 'HIGH':
                            getByRisk(rl='HIGH')
                            break;
                        case 'MODERATE':
                            getByRisk(rl='MODERATE')
                            break;
                        case 'LOW':
                            getByRisk(rl='LOW')
                            break;
                    }
                }
                //create a reset button to reset the chart
                var resetButton = document.createElement('button');
                resetButton.innerHTML = 'Reset';
                resetButton.onclick = function() {
                    getByRisk(rl=' ');
                };
        },
        tooltips: {
            callbacks: {
                label: function(tooltipItem, data) {
                    var dataset = data.datasets[tooltipItem.datasetIndex];
                    var total = dataset.data.reduce(function(previousValue, currentValue) {
                        return previousValue + currentValue;
                    });
                    var currentValue = dataset.data[tooltipItem.index];
                    var percentage = Math.floor(((currentValue/total) * 100)+0.5); // Round to nearest whole number
                    return data.labels[tooltipItem.index] + ": " + percentage + "%";
                }
            }
        },
        
        plugins: {
            // For Chart.js 3.x, tooltip configuration has moved under plugins
            tooltip: {
                callbacks: {
                    label: function(context) {
                        var label = context.label || '';
                        var data = context.dataset.data;
                        var dataSum = data.reduce((sum, val) => sum + val, 0);
                        var percentage = (data[context.dataIndex] / dataSum * 100).toFixed(2);
                        return label + ': ' + percentage + '%';
                    }
                }
            }
        }
    }
});

}
function getVendorProductCountByName(vendor){
  $.ajax({
        url: 'assets/PHP/functions.php',
        dataType: 'json',
        type: 'POST',
        data: {
            method: "getVendorProductCountByName",
            vendorName: vendor
        },
        beforeSend: function() {
            $('#loader').show();
        },
        success: function(data){
            console.log(data.items);
            var vendorCount = 0;
            var productCount = 0;
            var volumeCount = 0;
            var top = 0;
            var high = 0;
            var moderate = 0;
            var low = 0;
            for (var i = 0; i < data.items.length; i++) {
                vendorCount += parseFloat(data.items[i].VENDORS);
                productCount += parseFloat(data.items[i].PRODUCTS);
                volumeCount += parseFloat(data.items[i].ANNUAL_SALES);
                
                if(data.items[i].SCORE_CATEGORY != null && data.items[i].SCORE_CATEGORY == "TOP"){
                    var top = data.items[i].CATEGORY_COUNT;
                }
                if(data.items[i].SCORE_CATEGORY != null && data.items[i].SCORE_CATEGORY == "HIGH"){
                    var high = data.items[i].CATEGORY_COUNT;
                }
                if(data.items[i].SCORE_CATEGORY != null && data.items[i].SCORE_CATEGORY == "MODERATE"){
                    var moderate = data.items[i].CATEGORY_COUNT;
                }
                if(data.items[i].SCORE_CATEGORY != null && data.items[i].SCORE_CATEGORY == "LOW"){
                    var low = data.items[i].CATEGORY_COUNT;
                }
          
                if(volumeCount > 0){
                    var volCount = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(volumeCount);
                }else{
                    var volCount = 0;
                }
            }
            console.log(top, high, moderate, low);
            donutChart(top, high, moderate, low);
            loadChart(top, high, moderate, low);

            $('#vendors').text(vendorCount);
            $('#products').text(productCount);
            $('#volume').text(volCount);

        },
        complete: function() {
            $('#loader').hide();
        },
        error: function(xhr, status, error) {
            $('#result').html("Error: " + error);
        }
    });
}

function getVendorProductCount(rl){
    $.ajax({
        url: 'assets/PHP/functions.php',
        dataType: 'json',
        type: 'POST',
        data: {
            method: "getVendorProductCount",
            riskLevel: rl
        },
        success: function(data){
            //console.log(data.items);
            if(rl.lendth > 0){
                var vendorCount = 0;
                var productCount = 0;
                for (var i = 0; i < data.items.length; i++) {
                    vendorCount += parseFloat(data.items[i].DISTINCT_VENDOR_COUNT);
                    productCount += parseFloat(data.items[i].DISTINCT_PRODUCT_COUNT);
                }
                $('#vendors').text(vendorCount);
                $('#products').text(productCount);
            }else{
                $('#vendors').text(data.items[0].DISTINCT_VENDOR_COUNT);
                $('#products').text(data.items[0].DISTINCT_PRODUCT_COUNT);
            }
        },
        error: function(xhr, status, error) {
            $('#result').html("Error: " + error);
        }
    });
}
function getByVendor(vendor){
    $.ajax({
        url: 'assets/PHP/functions.php',
        dataType: 'json',
        type: 'POST',
        data: {
            method: "getByVendor", 
            vendorName: vendor
        },
        beforeSend: function() {
            $('#loader').show();
        },
        success: function(data){
            var tbl = data.items
            var high = 0;
            var top = 0;
            var moderate = 0;
            var low = 0;
            for (var i = 0; i < tbl.length; i++) {
                if(tbl[i].SCORE_CATEGORY == 'HIGH'){
                    high++;
                }else if(tbl[i].SCORE_CATEGORY == 'TOP'){
                    top++;
                }else if(tbl[i].SCORE_CATEGORY == 'MODERATE'){
                    moderate++;
                }else if(tbl[i].SCORE_CATEGORY == 'LOW'){
                    low++;
                }
            }
            donutChart(top, high, moderate, low);
            loadChart(top, high, moderate, low);

            var volume = 0;
            for (var i = 0; i < tbl.length; i++) {
                volume += parseFloat(tbl[i].ANNUAL_SALES);
            }
            var volCount = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(volume);
            $('#volume').text(volCount);

            if ($.fn.DataTable.isDataTable('#aimTblData')) {
                $('#aimTblData').DataTable().destroy();
            }
            var table = $("#aimTblData").DataTable({
                "data": tbl,
                "columns": [
                    { "data": "SCORE_CATEGORY" },
                    { "data": "RATING_SCORE" },
                    { "data": "VENDOR_NAME" },
                    { "data": "SELLER_FIRST_NAME" },
                    { "data": "PRODUCT_NAME" },
                    { "data": "STREET_NAME" },
                    { "data": "CITY" },
                    { "data": "STATE" },
                    { "data": "ZIP_CODE" },
                    { "data": "WEIGHT", "visible": false},
                    { "data": "VENDOR_NAME" },
                    { "data": "SELLER_FIRST_NAME" },
                    { "data": "PRODUCT_NAME" },
                    { "data": "STREET_NAME" },
                    { "data": "CITY" },
                    { "data": "STATE" },
                    { "data": "ZIP_CODE" },
                    { "data": "WEIGHT", "visible": false},
                ],
                "order": [[4, "desc"]],
                "createdRow": function(row, data, dataIndex) {
                  if(data.SCORE_CATEGORY == 'TOP'){
                        $('td:eq(0)', row).css('background-color','rgb(255,99,132)').addClass('rounded');
                    }else if(data.SCORE_CATEGORY == 'HIGH'){
                        $('td:eq(0)', row).css('background-color','rgb(255,159,64)').addClass('rounded');
                    }else if(data.SCORE_CATEGORY == 'MODERATE'){
                        $('td:eq(0)', row).css('background-color','rgb(255,205,86)').addClass('rounded');
                    }else if(data.SCORE_CATEGORY == 'LOW'){
                        $('td:eq(0)', row).css('background-color','rgb(54,162,235)').addClass('rounded');
                    }
            }
            });

            $('#aimTblData tbody').on('click', 'td', function () {
                var data = $('#aimTblData').DataTable().row( this ).data();
                if(data.SCORE_CATEGORY == 'TOP'){
                    var color = '#ff6384';
                }else if(data.SCORE_CATEGORY == 'HIGH'){
                    var color = '#ff9f40';
                }else if(data.SCORE_CATEGORY == 'MODERATE'){
                    var color = '#ffcd56';
                }else if(data.SCORE_CATEGORY == 'LOW'){
                    var color = '#36a2eb';
                }
                let ProductPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(data.PRODUCT_PRICE);
                let AnnualSales = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(data.ANNUAL_SALES);
                
                var originalPrice = parseFloat($(data.PRODUCT_PRICE));
                var variancePercentage = (Math.random() * 20) - 80; // Random variance between -10% and +10%
                var newPrice = originalPrice + (originalPrice * variancePercentage / 100);
                var newPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(newPrice.toFixed(2)); 
                if(data.PRODUCT_NAME == 'Ove Glove'){
                        $('.imageCompare').show();  
                        if(data.VENDOR_NAME == 'Amazon'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Amazon.jpeg');
                            $('.fakeFrom').text('Image from Amazon');
                        }else if(data.VENDOR_NAME == 'Walmart'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Walmart.jpg');
                            $('.fakeFrom').text('Image from Walmart');
                        }else if(data.VENDOR_NAME == 'Ebay'){
                            $('.fake').attr('src', 'assets/images/Product_Images/ebay.jpg');
                            $('.fakeFrom').text('Image from Ebay');
                        }else if(data.VENDOR_NAME == 'Sears'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Sears.jpeg');
                            $('.fakeFrom').text('Image from Sears');
                        }else if(data.VENDOR_NAME == 'Shien'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Shien.jpg');
                            $('.fakeFrom').text('Image from Shien');
                        }else if(data.VENDOR_NAME == 'alibaba'){
                            $('.fake').attr('src', 'assets/images/Product_Images/alibaba.jpg');
                            $('.fakeFrom').text('Image from Alibaba');
                        }else{
                            $('.fake').attr('src', 'assets/images/Product_Images/fake_oveGlove.webp');
                            $('.fakeFrom').text('Counterfeit product');
                        }
                    }
                
                $('#VENDOR_NAME').text(data.VENDOR_NAME);
                $('#VendorName').text(data.VENDOR_NAME);
                $('#VENDOR_ID').text(data.VENDOR_ID);
                $('#PRODUCT_NAME').text(data.PRODUCT_NAME);
                $('#STREET_NAME').text(data.STREET_NAME);
                $('#CITY').text(data.CITY);
                $('#STATE').text(data.STATE);
                $('#ZIP_CODE').text(data.ZIP_CODE);
                $('#SELLER_FIRST_NAME').text(data.SELLER_FIRST_NAME);
                $('#SELLER_LAST_NAME').text(data.SELLER_LAST_NAME);
                $('#ANNUAL_SALES').text(AnnualSales);
                $('#PRODUCT_GATEGORY').text(data.PRODUCT_GATEGORY);
                $('#RATING_SCORE').text(data.RATING_SCORE)
                $('#TOTAL_SCORE').text(data.TOTAL_SCORE);
                $('#Product_Diversity_Score').text(data.Product_Diversity_Score);
                $('#SELLER_PHONE').text(data.SELLER_PHONE);
                $('#SELLER_EMAIL').text(data.SELLER_EMAIL);
                $('#PRODUCT_PRICE').text(ProductPrice);
                $('#PRICE_VARIANCE').text(newPrice);
                $('#SCORE_CATEGORY').html('<span class="p-1 rounded" style="background-color:'+color+'">'+data.SCORE_CATEGORY+'</span>');
                $('.SCORE_CATEGORY').html(data.SCORE_CATEGORY);
                //getByVendor(vendorName=data.VENDOR_NAME);

                $('#reportIt').modal('show');
            });
        },
        complete: function() {
            $('#loader').hide();
        },
        error: function(xhr, status, error) {
            $('#result').html("Error: " + error);
        }
    });
  }

    function getByRisk(rl){
        $.ajax({
            url: 'assets/PHP/functions.php',
            dataType: 'json',
            type: 'POST',
            data: {
                method: "getByRiskLevel", 
                riskLevel: rl
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(data){
                var tbl = data.items
                //console.log(tbl);
                getVendorProductCount(rl)
                var high = 0;
                var top = 0;
                var moderate = 0;
                var low = 0;
                for (var i = 0; i < tbl.length; i++) {
                    if(tbl[i].SCORE_CATEGORY == 'HIGH'){
                        high++;
                    }else if(tbl[i].SCORE_CATEGORY == 'TOP'){
                        top++;
                    }else if(tbl[i].SCORE_CATEGORY == 'MODERATE'){
                        moderate++;
                    }else if(tbl[i].SCORE_CATEGORY == 'LOW'){
                        low++;
                    }
                }
                donutChart(top, high, moderate, low);
                loadChart(top, high, moderate, low);

                var volume = 0;
                for (var i = 0; i < tbl.length; i++) {
                    volume += parseFloat(tbl[i].ANNUAL_SALES);
                }
                var volCount = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(volume);
                $('#volume').text(volCount);

                if ($.fn.DataTable.isDataTable('#aimTblData')) {
                    var table = $('#aimTblData').DataTable().destroy(); // Destroy the instance
                }

               $("#aimTblData").DataTable({
                    "data": tbl,
                    "columns": [
                        { "data": "SCORE_CATEGORY" },
                        { "data": "RATING_SCORE" },
                        { "data": "VENDOR_NAME" },
                        { "data": "SELLER_FIRST_NAME" },
                        { "data": "PRODUCT_NAME" },
                        { "data": "STREET_NAME" },
                        { "data": "CITY" },
                        { "data": "STATE" },
                        { "data": "ZIP_CODE" },
                        { "data": "WEIGHT", "visible": false}
                    ],
                    "order": [[4, "desc"]],
                    "createdRow": function(row, data, dataIndex) {
                      if(data.SCORE_CATEGORY == 'TOP'){
                          $('td:eq(0)', row).css('background-color','rgb(255,99,132)').addClass('rounded');
                      }else if(data.SCORE_CATEGORY == 'HIGH'){
                          $('td:eq(0)', row).css('background-color','rgb(255,159,64)').addClass('rounded');
                      }else if(data.SCORE_CATEGORY == 'MODERATE'){
                          $('td:eq(0)', row).css('background-color','rgb(255,205,86)').addClass('rounded');
                      }else if(data.SCORE_CATEGORY == 'LOW'){
                          $('td:eq(0)', row).css('background-color','rgb(54,162,235)').addClass('rounded');
                      }
                  }
                });
                
                $('#externalSearchBox').on('keyup', function() {
                    var table = $('#aimTblData').DataTable()
                    table.columns(4).search(this.value).draw();
                    table.order([9, 'desc']).draw();
                    var vendor = this.value;
                    if (vendor.length > 0) {
                        getVendorProductCountByName(vendor)
                    }else{
                        getVendorProductCount(rl)
                    }
                });

                $('#aimTblData tbody').on('click', 'tr', function () {
                    var data = $('#aimTblData').DataTable().row( this ).data();
                    if(data.SCORE_CATEGORY == 'TOP'){
                        var color = '#ff6384';
                    }else if(data.SCORE_CATEGORY == 'HIGH'){
                        var color = '#ff9f40';
                    }else if(data.SCORE_CATEGORY == 'MODERATE'){
                        var color = '#ffcd56';
                    }else if(data.SCORE_CATEGORY == 'LOW'){
                        var color = '#36a2eb';
                    }
                    let ProductPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(data.PRODUCT_PRICE);
                    let AnnualSales = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(data.ANNUAL_SALES);
                    
                    var originalPrice = parseFloat(data.PRODUCT_PRICE);
                    var variancePercentage = (Math.random() * 20) - 80; // Random variance between -10% and +10%
                    var newPrice = originalPrice + (originalPrice * variancePercentage / 100);
                    var newPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(newPrice.toFixed(2)); 

                    $('#VENDOR_NAME').text(data.VENDOR_NAME);
                    $('#VendorName').text(data.VENDOR_NAME);
                    $('#VENDOR_ID').text(data.VENDOR_ID);
                    $('#PRODUCT_NAME').text(data.PRODUCT_NAME);
                    $('#STREET_NAME').text(data.STREET_NAME);
                    $('#CITY').text(data.CITY);
                    $('#STATE').text(data.STATE);
                    $('#ZIP_CODE').text(data.ZIP_CODE);
                    $('#SELLER_FIRST_NAME').text(data.SELLER_FIRST_NAME);
                    $('#SELLER_LAST_NAME').text(data.SELLER_LAST_NAME);
                    $('#ANNUAL_SALES').text(AnnualSales);
                    $('#PRODUCT_GATEGORY').text(data.PRODUCT_GATEGORY);
                    $('#RATING_SCORE').text(data.RATING_SCORE)
                    $('#TOTAL_SCORE').text(data.TOTAL_SCORE);
                    $('#Product_Diversity_Score').text(data.Product_Diversity_Score);
                    $('#SELLER_PHONE').text(data.SELLER_PHONE);
                    $('#SELLER_EMAIL').text(data.SELLER_EMAIL);
                    $('#PRODUCT_PRICE').text(ProductPrice);
                    $('#PRICE_VARIANCE').text(newPrice);
                    $('#SCORE_CATEGORY').html('<span class="p-1 rounded" style="background-color:'+color+'">'+data.SCORE_CATEGORY+'</span>');
                    $('.SCORE_CATEGORY').html(data.SCORE_CATEGORY);
                    getByVendor(vendorName=data.VENDOR_NAME, rl);
                    $('#vendorReport').modal('show');
                    if(data.PRODUCT_NAME == 'Ove Glove'){
                        $('.imageCompare').show();  
                        if(data.VENDOR_NAME == 'Amazon'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Amazon.jpeg');
                            $('.fakeFrom').text('Image from Amazon');
                        }else if(data.VENDOR_NAME == 'Walmart'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Walmart.jpg');
                            $('.fakeFrom').text('Image from Walmart');
                        }else if(data.VENDOR_NAME == 'Ebay'){
                            $('.fake').attr('src', 'assets/images/Product_Images/ebay.jpg');
                            $('.fakeFrom').text('Image from Ebay');
                        }else if(data.VENDOR_NAME == 'Sears'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Sears.jpeg');
                            $('.fakeFrom').text('Image from Sears');
                        }else if(data.VENDOR_NAME == 'Shien'){
                            $('.fake').attr('src', 'assets/images/Product_Images/Shien.jpg');
                            $('.fakeFrom').text('Image from Shien');
                        }else if(data.VENDOR_NAME == 'alibaba'){
                            $('.fake').attr('src', 'assets/images/Product_Images/alibaba.jpg');
                            $('.fakeFrom').text('Image from Alibaba');
                        }else{
                            $('.fake').attr('src', 'assets/images/Product_Images/fake_oveGlove.webp');
                            $('.fakeFrom').text('Counterfeit product');
                        }
                    }
                    
                });
            },
            complete: function() {
                $('#loader').hide();
            },
            error: function(xhr, status, error) {
               
                $('#result').html("Error: " + error);
            }
        });
    }

function loadStateSales(){
  $.ajax({
            url: 'assets/PHP/functions.php',
            dataType: 'json',
            type: 'POST',
            data: {
                method: "loadStateSales"
            },
            success: function(data){
                var tbl = data.items
                var stateSales = [];
                //console.log(tbl);
                for (var i = 0; i < tbl.length; i++) {
                    stateSales.push({
                        STATE: tbl[i].STATE,
                        total_sales: parseFloat(tbl[i].total_sales)
                    });
                }

                $('#geoChart').each(function(index, chart) {
                  // Check and destroy the existing chart if it's there
                  var existingChart = Chart.getChart(chart); // Correctly getting existing chart instance
                  if (existingChart) {
                      existingChart.destroy();
                  }

                  var ctx = chart.getContext("2d");
                  var geoChart = new Chart(ctx, {
                      type: "choropleth",
                      data: {
                          labels: stateSales.map(d => d.STATE), // Array of state names
                          datasets: [{
                              label: 'Annual Sales by State',
                              data: stateSales.map(d => ({
                                  feature: geojsonData.features.find(f => f.properties.name === d.STATE),
                                  value: d.total_sales
                              })),
                              backgroundColor: (context) => {
                                  const value = context.dataset.data[context.dataIndex].value;
                                  // Return a color based on the value
                                  return value > 1000000 ? 'rgba(255, 99, 132, 0.5)' : 'rgba(255, 159, 64, 0.5)';
                              }
                          }]
                      },
                      options: {
                          scales: {
                              xy: {
                                  projection: 'equalEarth'
                              }
                          }
                      }
                  });
              });

            },
            error: function(xhr, status, error) {
                $('#result').html("Error: " + error);
            }
    });

}
function drawGeoChart(stateSales) {
  console.log(stateSales)
    // Assuming `geojsonData` is defined elsewhere and accessible here
    $('#geoChart').each(function(index, chart) {
        // Check and destroy the existing chart if it's there
        var existingChart = Chart.getChart(chart); // Correctly getting existing chart instance
        if (existingChart) {
            existingChart.destroy();
        }

        var ctx = chart.getContext("2d");
        var geoChart = new Chart(ctx, {
            type: "choropleth",
            data: {
                labels: stateSales.map(d => d.STATE), // Array of state names
                datasets: [{
                    label: 'Annual Sales by State',
                    data: stateSales.map(d => ({
                        feature: geojsonData.features.find(f => f.properties.name === d.STATE),
                        value: d.total_sales
                    })),
                    backgroundColor: (context) => {
                        const value = context.dataset.data[context.dataIndex].value;
                        // Return a color based on the value
                        return value > 1000000 ? 'rgba(255, 99, 132, 0.5)' : 'rgba(255, 159, 64, 0.5)';
                    }
                }]
            },
            options: {
                scales: {
                    xy: {
                        projection: 'equalEarth'
                    }
                }
            }
        });
    });
}


</script>
